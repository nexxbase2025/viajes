<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>Danbury Wheel Chair Service — Dispatch</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
<header>
  <div class="logo" aria-label="Danbury Wheel Chair Service">
    <img src="./icons/icon-192.png" alt="DW"/>
    <div>
      <div style="font-size:15px;line-height:1">Danbury Wheel Chair Service</div>
      <div class="pill" id="rolePill">—</div>
    </div>
  </div>
  <div style="margin-left:auto;display:flex;align-items:center;gap:10px" class="no-print">
    <button id="btnInstall" class="btn" data-i18n="install">Install</button>
    <select id="langSel" class="btn" aria-label="Language">
      <option value="auto">🌐 Auto</option><option value="es">ES</option><option value="en">EN</option>
    </select>
    <button id="btnSignOut" class="btn" style="display:none" data-i18n="signout">Sign out</button>
  </div>
</header>

<div class="wrap">
  <!-- Landing / Login -->
  <section id="sectionAuth" class="card centered login-card">
    <img src="./icons/icon-192.png" width="72" height="72" alt="DW"/>
    <h2 id="welcomeTitle" data-i18n="welcome">Welcome</h2>
    <div class="muted" id="welcomeSub" data-i18n="signin">Sign in to continue</div>
    <div class="row" style="max-width:380px;width:100%">
      <div class="col-12"><input id="email" placeholder="email" autocomplete="username"/></div>
      <div class="col-12"><input id="password" placeholder="password" type="password" autocomplete="current-password"/></div>
      <div class="col-12 actions"><button id="btnSignIn" class="btn primary" style="width:100%" data-i18n="signin">Sign in</button></div>
    </div>
    <div class="muted" style="margin-top:10px" id="companyFooter">© 2025 Danbury Wheel Chair Service · On time, every time! · (203) 748 3433 · www.danburywheelchairservice.com</div>
  </section>

  <!-- Dispatcher UI -->
  <div id="dispatcherUI" style="display:none">
    <div class="grid">
      <section class="card" id="formCard">
        <h2 id="title_form" data-i18n="new_dispatch">New dispatch</h2>
        <div class="row">
          <div class="col-6">
            <label id="lbl_client" data-i18n="client">Client / Requester</label>
            <input id="clientName" />
          </div>
          <div class="col-6">
            <label id="lbl_client_phone" data-i18n="client_phone">Client phone/email</label>
            <input id="clientContact" />
          </div>
          <div class="col-8">
            <label id="lbl_pick" data-i18n="pick">Pickup (origin)</label>
            <input id="from" />
          </div>
          <div class="col-4">
            <label id="lbl_pick_time" data-i18n="pick_time">Date/Time</label>
            <input id="pickupAt" type="datetime-local"/>
          </div>
          <div class="col-12">
            <label id="lbl_drop" data-i18n="drop">Dropoff (destination)</label>
            <input id="to" />
          </div>
          <div class="col-6">
            <label id="lbl_passenger" data-i18n="passenger">Passenger</label>
            <input id="passenger" />
          </div>
          <div class="col-2">
            <label id="lbl_age" data-i18n="age">Age</label>
            <input id="age" type="number" min="0" max="120"/>
          </div>
          <div class="col-4">
            <label id="lbl_companions" data-i18n="companions">Companions</label>
            <input id="companions" type="number" min="0" value="0"/>
          </div>
          <div class="col-12">
            <label id="lbl_needs" data-i18n="needs">Needs / Accessibility</label>
            <div class="row">
              <div class="col-4"><label class="pill"><input type="checkbox" id="needWheel"/> <span data-i18n="need_wheel">Wheelchair</span></label></div>
              <div class="col-4"><label class="pill"><input type="checkbox" id="needBari"/> <span data-i18n="need_bari">Bariatric chair</span></label></div>
              <div class="col-4"><label class="pill"><input type="checkbox" id="needStret"/> <span data-i18n="need_stret">Stretcher</span></label></div>
              <div class="col-4"><label class="pill"><input type="checkbox" id="needOxy"/> <span data-i18n="need_oxy">Oxygen</span></label></div>
              <div class="col-8"><label class="pill"><input type="checkbox" id="needExtra"/> <span data-i18n="need_extra">Extra staff</span></label></div>
            </div>
          </div>
          <div class="col-4">
            <label id="lbl_floor" data-i18n="floor">Destination floor</label>
            <input id="floor" type="number" min="0" value="0"/>
          </div>
          <div class="col-4">
            <label id="lbl_no_elev" data-i18n="no_elev">No elevator?</label>
            <select id="noElev"><option value="no" data-i18n="no">No</option><option value="yes" data-i18n="yes">Yes</option></select>
          </div>
          <div class="col-4">
            <label id="lbl_steps" data-i18n="steps"># steps</label>
            <input id="steps" type="number" min="0" value="0"/>
          </div>
          <div class="col-4">
            <label id="lbl_price" data-i18n="price">Price (USD)</label>
            <input id="price" type="number" min="0" step="0.01"/>
          </div>
          <div class="col-8">
            <label id="lbl_notes" data-i18n="notes">Notes</label>
            <input id="notes" />
          </div>
          <div class="col-12">
            <label id="lbl_driver" data-i18n="driver">Driver / Vehicle</label>
            <select id="driverSel"></select>
            <div class="muted" id="driverInfo"></div>
          </div>
        </div>
        <div class="actions no-print">
          <button class="btn" id="btnPreview">📄 <span data-i18n="generate">Generate summary</span></button>
          <button class="btn primary" id="btnSendDriver">📨 <span data-i18n="send">Send to driver</span></button>
          <a class="btn" id="btnMap" target="_self"><span data-i18n="open_map">Open map</span></a>
          <button class="btn" id="btnClientData"><span data-i18n="client_data">Client data</span></button>
          <button class="btn ghost" id="btnPrint" data-i18n="print">Print</button>
          <button class="btn" id="btnBackup" data-i18n="backup">Set backup</button>
          
        </div>
        <div class="hr"></div>
        <div>
          <label class="muted" id="lbl_preview" data-i18n="preview">Message preview</label>
          <div id="preview" class="preview"></div>
        </div>
      </section>

      <aside class="card">
        <h2 id="title_fleet" data-i18n="drivers">Drivers</h2>
        <div id="fleetList"></div>
        <div class="hr"></div>
        <div class="kpis">
          <div class="kpi" id="kpiTodayCard"><div class="muted" id="kpi_today" data-i18n="jobs_today">Jobs today</div><b id="kpiToday">0</b></div>
          <div class="kpi" id="kpiPendingCard"><div class="muted" id="kpi_pending" data-i18n="scheduled">Scheduled</div><b id="kpiPending">0</b></div>
          <div class="kpi"><div class="muted" id="kpi_drivers" data-i18n="drivers">Drivers</div><b id="kpiDrivers">—</b></div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Driver UI -->
  <div id="driverUI" style="display:none">
    <section class="card">
      <h2 id="drv_title" data-i18n="my_jobs">My jobs</h2>
      <div class="actions">
        <span class="pill">✅ <b id="drv_done_lbl" data-i18n="trips_done">Trips done</b>: <span id="drv_done_count">0</span></span>
        <span class="pill">🗓️ <b id="drv_sched_lbl" data-i18n="trips_sched">Scheduled</b>: <span id="drv_sched_count">0</span></span>
      </div>
      <div class="hr"></div>
      <div class="row">
        <div class="col-12">
          <h3 data-i18n="today">Today</h3>
          <div id="drv_today" class="preview">(empty)</div>
        </div>
        <div class="col-12">
          <h3 data-i18n="upcoming">Upcoming</h3>
          <div id="drv_upcoming" class="preview">(empty)</div>
        </div>
      </div>
    </section>
  </div>

  <div class="footer no-print">© 2025 Danbury Wheel Chair Service • </div>
</div>

<!-- How to install -->
<dialog id="howTo">
  <form method="dialog" style="margin:0">
    <div style="padding:16px 16px 4px"><b data-i18n="howto_title">Install on iPhone/iPad</b></div>
    <div style="padding:0 16px 12px" class="muted" id="howto_body">1) Open in Safari · 2) Tap <b>Share</b> · 3) <b>Add to Home Screen</b> · 4) Confirm.</div>
    <div style="display:flex;justify-content:flex-end;padding:0 12px 12px"><button class="btn" data-i18n="ok">OK</button></div>
  </form>
</dialog>

<!-- KPI list -->
<dialog id="listDlg">
  <form method="dialog" style="margin:0">
    <div style="padding:16px 16px 4px"><b id="listDlgTitle">Items</b></div>
    <div style="padding:0 16px 12px; max-height:50vh; overflow:auto">
      <div id="listDlgBody" class="preview"></div>
    </div>
    <div style="display:flex;justify-content:flex-end;padding:0 12px 12px"><button class="btn" data-i18n="close">Close</button></div>
  </form>
</dialog>

<!-- Client data -->
<dialog id="clientDlg">
  <form method="dialog" style="margin:0">
    <div style="padding:16px 16px 4px"><b data-i18n="client_data">Client data</b></div>
    <div style="padding:0 16px 12px">
      <div class="row">
        <div class="col-12"><input id="clientSendTo" placeholder="WhatsApp (+1...), SMS (+1...), or email"/></div>
        <div class="col-12 actions">
          <button class="btn" id="sendToWA" data-i18n="send_whatsapp">Send WhatsApp</button>
          <button class="btn" id="sendToSMS" data-i18n="send_sms">Send SMS</button>
          <button class="btn" id="sendToEmail" data-i18n="send_email">Send Email</button>
        </div>
      </div>
      <div id="clientPreview" class="preview"></div>
    </div>
    <div style="display:flex;justify-content:flex-end;padding:0 12px 12px"><button class="btn" data-i18n="close">Close</button></div>
  </form>
</dialog>

<!-- Backup -->
<dialog id="backupDlg">
  <form method="dialog" style="margin:0">
    <div style="padding:16px 16px 4px"><b data-i18n="backup">Set backup</b></div>
    <div style="padding:0 16px 12px">
      <p class="muted" data-i18n="backup_desc">Backups are stored on this device. You can export a JSON file anytime.</p>
      <label class="pill"><input type="checkbox" id="autoSave"/> <span data-i18n="backup_auto">Auto‑save summaries</span></label>
      <div class="hr"></div>
      <div class="actions">
        <button class="btn" id="btnExport" data-i18n="export_json">Export JSON</button>
        <button class="btn" id="btnExportTXT">Export TXT</button>
        <button class="btn" id="btnClearLocal" data-i18n="clear_local">Clear local</button>
      </div>
      <div class="muted" id="localInfo"></div>
    </div>
    <div style="display:flex;justify-content:flex-end;padding:0 12px 12px"><button class="btn" data-i18n="close">Close</button></div>
  </form>
</dialog>

<button id="installBubble" class="install-bubble" type="button" hidden>Install</button>
<dialog id="installHowToDlg" style="max-width:560px;border:none;border-radius:16px;padding:0;box-shadow:0 10px 40px rgba(0,0,0,.25)">
  <form method="dialog" style="margin:0">
    <div style="padding:16px 16px 6px;font-weight:700" id="installHowToTitle">How to install</div>
    <div style="padding:0 16px 16px;color:#666" id="installHowToBody">
      In Safari, tap the <b>Share</b> button and select <b>Add to Home Screen</b>.
    </div>
    <div style="display:flex;justify-content:flex-end;gap:8px;padding:0 12px 12px">
      <button value="ok" style="padding:.5rem 1rem;border-radius:10px;border:1px solid rgba(0,0,0,.15);background:#fff">OK</button>
    </div>
  </form>
</dialog>

<!-- External scripts -->
<script type="module" src="./app.js"></script>
<script src="./install-bubble.js"></script>
</body>
</html>